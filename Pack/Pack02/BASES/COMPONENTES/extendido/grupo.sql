CREATE OR REPLACE PACKAGE PC_GRUPO IS
	/*GRUPO*/
	PROCEDURE AD_GRUPO (xNOMBRE IN VARCHAR, xCREADOR IN VARCHAR);
	PROCEDURE MOD_GRUPO (xID_GRUPO IN NUMBER, xNOMBRE IN VARCHAR);
	
	/*TIENE*/
	PROCEDURE AD_TIENE (xID_GRUPO IN NUMBER, xID_TEMA IN VARCHAR);
	
	/*PERTENECE GRUPO*/
	PROCEDURE AD_PERTENECE (xID_USUARIO IN VARCHAR, xID_GRUPO IN NUMBER);
	PROCEDURE EL_PERTENECE (xID_USUARIO IN VARCHAR, xID_GRUPO IN NUMBER);
	
	FUNCTION CO_GRUPO RETURN SYS_REFCURSOR;
	FUNCTION CONS_GRUPO RETURN SYS_REFCURSOR;
	FUNCTION CO_TIENE RETURN SYS_REFCURSOR;
	FUNCTION CO_PERTENECE RETURN SYS_REFCURSOR;

END PC_GRUPO;

CREATE OR REPLACE PACKAGE BODY PC_GRUPO IS

	PROCEDURE AD_GRUPO (xNOMBRE IN VARCHAR, xCREADOR IN VARCHAR) IS
		BEGIN
		INSERT INTO GRUPOS (ID_GRUPO,NOMBRE,CREADOR) VALUES (SEQ_GRUPOS.NEXTVAL,xNOMBRE,xCREADOR);
		COMMIT;
		EXCEPTION
		WHEN OTHERS THEN
		ROLLBACK;
		RAISE_APPLICATION_ERROR(-20032,'No se puede insertar en grupos.');
	END;
	
	PROCEDURE MOD_GRUPO (xID_GRUPO IN NUMBER, xNOMBRE IN VARCHAR) IS
		BEGIN
		UPDATE GRUPOS SET NOMBRE= xNOMBRE WHERE ID_GRUPO= xID_GRUPO;
		COMMIT;
		EXCEPTION
		WHEN OTHERS THEN
		ROLLBACK;
		RAISE_APPLICATION_ERROR (-20021,'No se puede modificar el grupo.');
	END;
	
	PROCEDURE AD_TIENE (xID_GRUPO IN NUMBER, xID_TEMA IN VARCHAR) IS
		BEGIN
		INSERT INTO GRUPO_TIENE_TEMA (ID_GRUPO,ID_TEMA) VALUES (xID_GRUPO,xID_TEMA);
		COMMIT;
		EXCEPTION
		WHEN OTHERS THEN
		ROLLBACK;
		RAISE_APPLICATION_ERROR(-20033,'No se puede insertar en grupo tiene tema.');
	END;
	

	PROCEDURE AD_PERTENECE (xID_USUARIO IN VARCHAR, xID_GRUPO IN NUMBER) IS 
		BEGIN 
		INSERT INTO PERTENECE_GRUPO (ID_USUARIO,ID_GRUPO) VALUES (xID_USUARIO,xID_GRUPO);
		COMMIT;
		EXCEPTION
		WHEN OTHERS THEN
		ROLLBACK;
		RAISE_APPLICATION_ERROR(-20033,'No se puede insertar en pertenece grupo.');
	END;
	
	PROCEDURE EL_PERTENECE (xID_USUARIO IN VARCHAR, xID_GRUPO IN NUMBER) IS
		BEGIN
		DELETE FROM PERTENECE_GRUPO WHERE ID_GRUPO= xID_GRUPO AND ID_USUARIO= xID_USUARIO;
		COMMIT;
		EXCEPTION
		WHEN OTHERS THEN
		ROLLBACK;
		RAISE_APPLICATION_ERROR(-20013,'No se puede eliminar este usuario.');
	END;

	FUNCTION CO_GRUPO RETURN SYS_REFCURSOR IS CON_GRUPO SYS_REFCURSOR;
		BEGIN
		OPEN CON_GRUPO FOR
			SELECT DISTINCT USERNAME,U.NOMBRE,ID_GRUPO,G.NOMBRE  FROM USUARIOS U,GRUPOS  G
			WHERE G.CREADOR= USERNAME;
		RETURN CON_GRUPO;
	END;
	
	FUNCTION CONS_GRUPO RETURN SYS_REFCURSOR IS CO_GRUP SYS_REFCURSOR;
		BEGIN 
		OPEN CO_GRUP FOR
			SELECT * FROM GRUPOS;
		RETURN CO_GRUP;
	END;
	
	FUNCTION CO_TIENE RETURN SYS_REFCURSOR IS CON_TIENE SYS_REFCURSOR;
		BEGIN
		OPEN CON_TIENE FOR
			SELECT * FROM GRUPO_TIENE_TEMA;
		RETURN CON_TIENE;
	END;
	
	FUNCTION CO_PERTENECE RETURN SYS_REFCURSOR IS CON_PERTENECE SYS_REFCURSOR;
		BEGIN
		OPEN CON_PERTENECE FOR
			SELECT * FROM PERTENECE_GRUPO;
		RETURN CON_PERTENECE;
	END;
	
END PC_GRUPO;



